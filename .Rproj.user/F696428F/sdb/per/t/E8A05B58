{
    "collab_server" : "",
    "contents" : "# Load Daily Toronto Temperature Data (1990-2017)\n\n# Initialize Session ####\ncat(\"\\014\")\nrm(list=ls())\ncat(\"\\014\")\nSys.Date()\nsessionInfo()\n\nlist.of.packages <- c(\"readxl\",\"readr\",\"ggplot2\",\"dplyr\",\"magrittr\",\"viridis\",\"lubridate\",\"grid\",\"gridExtra\")\nnew.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,\"Package\"])]\nif(length(new.packages)) install.packages(new.packages)\nlapply(list.of.packages, require, character.only = TRUE)\n\ndir.path <- getwd()\nsetwd(dir.path)\n\nweather.files <- list.files(\"data/weather\", pattern = \"\\\\.csv$\", full.names = T)\n# NO MEAN TEMPERATURE FOR >2003 years, download more files from\n# http://climate.weather.gc.ca/climate_data/daily_data_e.html?timeframe=2&hlyRange=2002-06-04%7C2017-10-24&dlyRange=2002-06-04%7C2017-10-24&mlyRange=2003-07-01%7C2006-12-01&StationID=31688&Prov=ON&urlExtension=_e.html&searchType=stnProx&optLimit=yearRange&StartYear=2004&EndYear=2017&selRowPerPage=25&Line=0&txtRadius=25&optProxType=custom&selCity=&selPark=&Day=24&Year=2004&Month=12#\n\n\ndf <- weather.files %>% \n   lapply(read_csv,skip = 25, \n          col_types = cols(`Date/Time` = col_character(),\n                           `Year` = col_integer(),\n                           `Month` = col_integer(),\n                           `Day` = col_integer(),\n                           `Data Quality` = col_character(),\n                           `Max Temp (°C)`  = col_number(),\n                           `Max Temp Flag` = col_character(),\n                           `Min Temp (°C)` = col_number(),\n                           `Min Temp Flag` = col_character(),\n                           `Mean Temp (°C)` = col_number(),\n                           `Mean Temp Flag` = col_character(),\n                           `Heat Deg Days (°C)` = col_number(),\n                           `Heat Deg Days Flag` = col_character(),\n                           `Cool Deg Days (°C)` = col_number(),\n                           `Cool Deg Days Flag` = col_character(),\n                           `Total Rain (mm)` = col_number(),\n                           `Total Rain Flag` = col_character(),\n                           `Total Snow (cm)` = col_number(),\n                           `Total Snow Flag` = col_character(),\n                           `Total Precip (mm)` = col_number(),\n                           `Total Precip Flag` = col_character(),\n                           `Snow on Grnd (cm)` = col_number(),\n                           `Snow on Grnd Flag` = col_character(),\n                           `Dir of Max Gust (10s deg)` = col_number(),\n                           `Dir of Max Gust Flag` = col_character(),\n                           `Spd of Max Gust (km/h)` = col_number(),\n                           `Spd of Max Gust Flag` = col_character())) %>%\n   bind_rows()\n\n# Rename Column Names\nnames(df)\n\ndf <- df %>% \n   rename(Date = `Date/Time`, Data_Quality = `Data Quality`,\n          Max_TC = `Max Temp (°C)`, Min_TC = `Min Temp (°C)`,\n          Mean_TC = `Mean Temp (°C)`, Heat_C = `Heat Deg Days (°C)`,\n          Cool_C = `Cool Deg Days (°C)`, Tot_Rain_mm = `Total Rain (mm)`,\n          Tot_Snow_cm = `Total Snow (cm)`, Tot_Precip_mm = `Total Precip (mm)`,\n          Snow_G_cm = `Snow on Grnd (cm)`, D_Max_Gust_deg = `Dir of Max Gust (10s deg)`,\n          Max_Gust_kmh = `Spd of Max Gust (km/h)`) %>% \n   rename(Max_T_Flag = `Max Temp Flag`,\n          Min_T_Flag = `Min Temp Flag`,\n          Mean_T_Flag = `Mean Temp Flag`,\n          Heat_Flag = `Heat Deg Days Flag`,\n          Cool_Flag = `Cool Deg Days Flag`,\n          Tot_Rain_Flag = `Total Rain Flag`,\n          Tot_Snow_Flag = `Total Snow Flag`,\n          Tot_Precip_Flag = `Total Precip Flag`,\n          Snow_G_Flag = `Snow on Grnd Flag`,\n          D_Max_Gust_Flag = `Dir of Max Gust Flag`,\n          Max_Gust_Flag = `Spd of Max Gust Flag`)\n                               \n# Change to Appropriate Column Types ####\nstr(df)\n\nremover <- function(x) {gsub(\"\\\\s*\", \"F\", x)}\n# newflags <- df %>% select(ends_with(\"Flag\")) %>% \n#    mutate_each(funs(remover)) %>% #replaces all blanks with F\n#    mutate_each(funs(gsub(\"^FTF\",\"T\",.))) %>% #replaces all \"FTF\" with T\n#    mutate_each(funs(as.logical)) #convert to logical\n\ndf <- df %>% select(-ends_with(\"Flag\")) %>% \n   bind_cols(df %>% select(ends_with(\"Flag\")) %>% \n                mutate_each(funs(remover)) %>% #replaces all blanks with F\n                mutate_each(funs(gsub(\"^FTF\",\"T\",.))) %>% #replaces all \"FTF\" with T\n                mutate_each(funs(as.logical)) #convert to logical\n             )\n\n# Convert to Date-time\ndf$Date <- ymd(df$Date) # convert 'Date' to date object\ndf$Year <- as.Date(paste(df$Year, 1, 1, sep = \"-\")) #convert 'Year' to date object\nyear(df$Year) #convert back to numeric value\n\ndf$Month <- month(df$Month, label = T) #\ndf$Day #day of month\n\ndf %>% filter(Year > \"2004-01-01\") %>% select(starts_with(\"Mean\"))\n\n# watermain data\nas.POSIXct(df$Date, tz =\"UTC\")\nstr(df$Date)\nwm.df$Date <- as.Date(wm.df$Date)\nwm.df$wmbreak <- rep(38,length(wm.df$Date))\nmerge.df <- left_join(df,wm.df, by=\"Date\")\n\ngetSeason <- function(DATES) {\n   WS <- as.Date(\"2012-12-15\", format = \"%Y-%m-%d\") # Winter Solstice\n   SE <- as.Date(\"2012-3-15\",  format = \"%Y-%m-%d\") # Spring Equinox\n   SS <- as.Date(\"2012-6-15\",  format = \"%Y-%m-%d\") # Summer Solstice\n   FE <- as.Date(\"2012-9-15\",  format = \"%Y-%m-%d\") # Fall Equinox\n   \n   # Convert dates from any year to 2012 dates\n   d <- as.Date(strftime(DATES, format=\"2012-%m-%d\"))\n   \n   ifelse (d >= WS | d < SE, \"Winter\",\n           ifelse (d >= SE & d < SS, \"Spring\",\n                   ifelse (d >= SS & d < FE, \"Summer\", \"Fall\")))\n}\nmerge.df$Season <- getSeason(merge.df$Date)\n\nmerge.df <- merge.df %>% mutate(B = gl(4,37470/4,labels = c(\"Fall\",\"Summer\",\"Spring\",\"Winter\")))\n\nlength(merge.df$Date)\n\n\nggplot(data = merge.df, aes(x = Date)) + \n   geom_line(aes(y = Mean_TC), alpha = 0.5, size = 0.75) +\n   geom_jitter(aes(y = wmbreak), colour = \"#298A08\", height = 20, alpha = 0.1, size = 2) +\n   scale_x_date(limits = c(as.Date(\"1990-01-01\"),as.Date(\"2004-01-01\"))) +\n   guides(colour = guide_legend(override.aes = list(alpha=1)))\n",
    "created" : 1510685183697.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1700036481",
    "id" : "E8A05B58",
    "lastKnownWriteTime" : 1510685241,
    "last_content_update" : 1510685241997,
    "path" : "~/GitHub/TO_Watermain/TO_weather.R",
    "project_path" : "TO_weather.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}